---
title: "路由和路由器"
date: 2025-12-04  # 文章发布时间
categories: [互联网计算] # 你的分类
tags: [笔记]     # 你的标签
math: true
---

## 路由器内部组件

![image-20230715220606525](https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/imagesimage-20230715220606525.png)

路由器也是特殊组件的计算机

> 路由器为什么是“计算机”？
>
> 因为它同时满足所有计算机的核心要素：
>
> > **① 有 CPU（处理器）
> >  ② 有可读写的运行空间（RAM）
> >  ③ 有可长期保存指令与数据的存储器（NVRAM / ROM / Flash）
> >  ④ 运行软件（固件）来执行任务
> >  ⑤ 能对输入做处理并产生输出**

- console 口进行具体的调试
- 辅助口（Auxiliary）：一般不用，但是可能会用到

#### 随机存取存储器

1. 路由器配置文件的临时存储，一般做内存使用
2. 断电或重新启动时 RAM 内容丢失
3. 存储：
   1. 路由表
   2. ARP缓存
   3. 快速切换缓存
   4. 报文缓存：可能前面有正在处理的，需要等待
   5. 数据包保留队列
4. 根据地址位就可以读到地址内容（访问比较快）

#### 非易失随机存取存储器---**存放“变量”**（路由器的用户设置）

NVRAM，Non-volatile RAM

1. 存储备份（backup）/启动（startup）配置文件
2. 路由器掉电或重启时内容不会丢失。
3. 内置电池的方式来保证不断电，这一部分可以整体单独拿出来
4. 保证快速访问，但是存储空间有限。

#### Flash---相当于计算机的SSD

相当于台式机硬盘

1. 电子可擦可编程只读存储器（EEPROM, Electronically Erasable Programmable Read-Only Memory）
2. 存储了 Cisco IOS（互联网操作系统）
3. 允许更新软件而无需更换闪存芯片
4. 可以存储多个版本的 IOS
5. 断电保持

#### 只读存储器---**存放“程序”**（固件、内核、引导程序）

ROM，Read-Only Memory

1. 包含 POST（开机自检）：PC 也有，开机的时候，读取一些参数进行对比，如果一样则保证硬件是正常的。
2. 引导程序（加载 Cisco IOS）
3. 作系统软件
   1. IOS 的备份，精简（trimmed down）版本
   2. 升级需要安装新的芯片组

#### 接口

1. 数据包通过其进入和离开路由器的网络连接口
2. 附在主板（motherboard）上或作为单独的模块。
3. 大部分是网口，主要是用来支持网络的
4. 0/0 第一个，串口接口可能还分多个

## 路由器启动步骤

### 系统启动程序

1. 执行开机自检（POST）：在此自检期间，路由器从所有硬件模块上的 ROM 执行诊断：如果有问题导致操作系统无法重启，那么我们就需要对硬件进行检查
2. 验证 CPU，内存和网络接口端口的基本操作。
3. 软件初始化。

### 软件启动程序

1. ROM 中的通用引导加载程序（bootstrap）在 CPU 卡上执行。
2. 可以在以下几个位置之一找到操作系统（Cisco IOS）。该位置在配置寄存器的引导字段中公开。
3. 加载操作系统映像。
   1. 先从 Flash 找，也就只有一个 image 文件，将 image 导入内存
   2. 如果 image 找不到，则到 TFTP Server，如果能找到则下载下拉一个 image
   3. 如果 TFTP 也没有配置，则去 ROM 中导出 IOS
4. 将保存在 NVRAM 中的**配置文件**加载到主存储器中，并一次执行一行。
   1. 先看 NVRAM 中有没有配置（start.config）
   2. 然后看 TFTP Server 有没有配置，如果有则下载一个
   3. 如果都没有，用 console 进行配置
5. 如果 NVRAM 中**没有**有效的配置文件，则执行问题驱动（question-driven）的初始配置例程，该例程称为系统配置对话框，也称为**设置模式**。

### 路由器初始化过程

1. 设置不用作在路由器中输入复杂协议功能的模式。
2. 对于大多数路由器配置任务，应使用安装程序提出最少的配置，然后使用各种 configuration mode 命令而非安装程序

![image-20230715220626800](https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/imagesimage-20230715220626800.png)