---
title: "高速缓存存储器-Cache"
date: 2025-10-23  # 文章发布时间
categories: [计算机组织与结构] # 你的分类
tags: [笔记]     # 你的标签
math: true
---

如何解决内存墙带来的CPU和主存协作问题？

- 在使用主存（相对大而慢）之余，添加一块小而快的cache
- Cache位于CPU和主存之间，可以集成在CPU内部或作为主板上的一个模块
- Cache中存放了主存中的部分信息的“副本”

<img src="https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/images%E6%88%AA%E5%B1%8F2025-10-23%2014.27.37.png" alt="截屏2025-10-23 14.27.37" style="zoom:50%;" />

## cache的工作流程

检查（Check）：当CPU试图访问主存中的某个字时，首先检查这个字是否在cache中

检查后分两种情况处理：

- 命中（Hit）：如果在cache中，则把这个字传送给CPU
- 未命中（Miss）：如果不在cache中, 则将主存中**包含**这个字**固定大小的块**（block）读入cache中，然后再从cache传送该字给CPU

注意：这个块的大小是预先分好的**（静态划分！静态划分！静态划分！动态划分太低效！）**，我想要的字仅仅是“包含”在这个块里

<img src="https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/images%E6%88%AA%E5%B1%8F2025-10-23%2014.14.23.png" alt="截屏2025-10-23 14.14.23" style="zoom:50%;" />

### 问题1:如何判断有没有命中

- 冯·诺伊曼体系的设计：CPU通过位置对主存中的内容进行寻址，不关心存储在其中的内容
- Cache通过标记（tags）来标识其内容在主存中的对应位置

注意：**Tag 存的是包含你我请求的那个字的、固定大小的块（Block）的起始地址的高位部分。**



### 程序访问的局部性原理

定义：处理器频繁访问主存中相同位置或者相邻存储位置的现象

#### 1. 时间局部性

- **核心思想**：如果一个数据被访问，那么它在**不久的将来**很可能**再次**被访问。也就是在相对较短的时间周期内，重复访问特定的信息（也就是访问相同位置的信息）的倾向

- cache的利用：将未命中的数据在返回给CPU的同时存放在Cache中，以便再次访问时命中

  <img src="https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/images%E6%88%AA%E5%B1%8F2025-10-23%2014.30.23.png" alt="截屏2025-10-23 14.30.23" style="zoom:50%;" />

#### 2.空间局部性

- **核心思想**：如果一个数据被访问，那么它在**不久的将来**很可能访问其**相邻地址**的数据。也就是在相对较短的时间周期内，访问相邻存储位置的数据的倾向
- 典例：顺序局部性：当数据被线性排列和访问时，出现的空间局部性的一种特殊情况---如遍历一维数组
- cache的利用：将包含所访问的字的块存储到Cache中，以便在访问相邻数据时命中

<img src="https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/images%E6%88%AA%E5%B1%8F2025-10-23%2014.32.14.png" alt="截屏2025-10-23 14.32.14" style="zoom: 50%;" />

### 问题4:使用Cache后需要更多的操作，为什么还可以节省时间?

- 假设p是命中率，$T_c$ 是cache的访问时间（检查时间），$T_M$ 是主存的访问时间，使用cache时的平均访问时间为
  
  

  $$T_A = p \times T_C + (1 - p) \times (T_C + T_M)$$  
  $$= T_C + (1 - p) \times T_M$$
  
  
  
- 命中率越大，$T_c$ 越小，效果越好

- 如果想要 $T_A < T_M$，必须要求  $$p > T_C / T_M$$
  
- 难点：cache的容量远远小于主存的容量



## Cache的构成

Cache系统包括： Cache控制器(虚框内)，Cache存储体

Cache由两个存储体构成：

- 标记存储体tag SRAM ：存放主存的组号
- 数据存储体Cache SRAM：存放组内对应块的主存信息

<img src="https://cdn.jsdelivr.net/gh/HEYWEEN/images@main/images%E6%88%AA%E5%B1%8F2025-10-23%2014.44.09.png" alt="截屏2025-10-23 14.44.09" style="zoom: 67%;" />



## Cache的设计要素

### Cache容量

扩大cache容量带来的结果：

增大了命中率$p$

增加了cache的开销和访问时间$T_c$